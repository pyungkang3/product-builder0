<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë™ë¬¼ìƒ ë©”ë‰´ ì¶”ì²œ</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .app {
            background: #fff;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            padding: 48px 36px;
            width: 100%;
            max-width: 480px;
            text-align: center;
        }

        .emoji-title { font-size: 48px; margin-bottom: 8px; }

        h1 {
            font-size: 28px;
            font-weight: 800;
            color: #1a1a2e;
            margin-bottom: 8px;
        }

        .desc {
            font-size: 15px;
            color: #888;
            margin-bottom: 32px;
            line-height: 1.5;
        }

        /* Upload area */
        .upload-area {
            border: 2.5px dashed #d0d0d0;
            border-radius: 16px;
            padding: 40px 20px;
            cursor: pointer;
            transition: border-color 0.2s, background 0.2s;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: #f8f8ff;
        }

        .upload-area.has-image {
            border-style: solid;
            border-color: #667eea;
            padding: 16px;
        }

        .upload-icon { font-size: 48px; margin-bottom: 12px; }

        .upload-text {
            font-size: 16px;
            font-weight: 600;
            color: #555;
            margin-bottom: 4px;
        }

        .upload-hint {
            font-size: 13px;
            color: #aaa;
        }

        #file-input { display: none; }

        #preview-img {
            max-width: 100%;
            max-height: 280px;
            border-radius: 12px;
            display: none;
        }

        #analyze-btn {
            padding: 16px 48px;
            font-size: 18px;
            font-weight: 700;
            border: none;
            border-radius: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            display: none;
        }

        #analyze-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5); }
        #analyze-btn:active { transform: scale(0.97); }
        #analyze-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

        .loading-text {
            font-size: 14px;
            color: #888;
            margin-top: 16px;
            display: none;
        }

        .loading-text .dot-animation::after {
            content: '';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0% { content: ''; }
            25% { content: '.'; }
            50% { content: '..'; }
            75% { content: '...'; }
        }

        /* Result */
        #result {
            display: none;
            margin-top: 32px;
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animal-card {
            animation: fadeUp 0.6s ease;
        }

        .result-emoji { font-size: 72px; margin-bottom: 12px; }

        .result-type {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .result-type.dog { color: #ff6b35; }
        .result-type.cat { color: #667eea; }

        .result-percent {
            font-size: 48px;
            font-weight: 800;
            margin: 8px 0;
        }

        .result-percent.dog { color: #ff6b35; }
        .result-percent.cat { color: #667eea; }

        .result-bar-wrap {
            background: #f0f0f0;
            border-radius: 12px;
            height: 16px;
            width: 100%;
            margin: 16px 0;
            overflow: hidden;
        }

        .result-bar {
            height: 100%;
            border-radius: 12px;
            transition: width 1s ease;
        }

        .result-bar.dog { background: linear-gradient(90deg, #ff6b35, #ff9a5c); }
        .result-bar.cat { background: linear-gradient(90deg, #667eea, #a78bfa); }

        .result-desc {
            font-size: 15px;
            color: #555;
            line-height: 1.7;
            margin: 16px 0;
            padding: 20px;
            background: #f8f8fa;
            border-radius: 12px;
            text-align: left;
        }

        .result-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-top: 12px;
        }

        .tag {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .tag.dog { background: #fff3ee; color: #ff6b35; }
        .tag.cat { background: #eef0ff; color: #667eea; }

        /* Menu recommendation section */
        .menu-section {
            margin-top: 32px;
            animation: fadeUp 0.6s ease 0.3s both;
        }

        .menu-section-title {
            font-size: 20px;
            font-weight: 800;
            color: #1a1a2e;
            margin-bottom: 16px;
        }

        .menu-cards {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .menu-card {
            background: #f8f8fa;
            border-radius: 16px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            text-align: left;
            animation: fadeUp 0.5s ease both;
        }

        .menu-card:nth-child(1) { animation-delay: 0.4s; }
        .menu-card:nth-child(2) { animation-delay: 0.55s; }
        .menu-card:nth-child(3) { animation-delay: 0.7s; }

        .menu-card-img {
            width: 72px;
            height: 72px;
            border-radius: 12px;
            object-fit: cover;
            flex-shrink: 0;
            background: #eee;
        }

        .menu-card-info {
            flex: 1;
            min-width: 0;
        }

        .menu-card-name {
            font-size: 17px;
            font-weight: 700;
            color: #1a1a2e;
            margin-bottom: 4px;
        }

        .menu-card-meta {
            font-size: 13px;
            color: #888;
        }

        .menu-card-emoji {
            font-size: 28px;
            flex-shrink: 0;
        }

        #retry-btn {
            margin-top: 28px;
            padding: 14px 40px;
            font-size: 16px;
            font-weight: 600;
            border: 2px solid #ddd;
            border-radius: 50px;
            background: #fff;
            color: #555;
            cursor: pointer;
            transition: all 0.2s;
        }

        #retry-btn:hover { border-color: #764ba2; color: #764ba2; }

        @media (max-width: 460px) {
            .app { padding: 32px 20px; }
            h1 { font-size: 24px; }
            .result-type { font-size: 26px; }
            .result-percent { font-size: 40px; }
            .menu-card-img { width: 60px; height: 60px; }
            .menu-card-name { font-size: 15px; }
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="emoji-title">ğŸ¶ğŸ½ï¸ğŸ±</div>
        <h1>ë™ë¬¼ìƒ ë©”ë‰´ ì¶”ì²œ</h1>
        <p class="desc">ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ë©´ AIê°€ ë™ë¬¼ìƒì„ ë¶„ì„í•˜ê³ <br>ë‹¹ì‹ ì—ê²Œ ë”± ë§ëŠ” ì €ë… ë©”ë‰´ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤!</p>

        <div class="upload-area" id="upload-area" onclick="document.getElementById('file-input').click()">
            <div class="upload-icon">ğŸ“·</div>
            <p class="upload-text">ì‚¬ì§„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”</p>
            <p class="upload-hint">í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”</p>
            <img id="preview-img" alt="ë¯¸ë¦¬ë³´ê¸°">
        </div>
        <input type="file" id="file-input" accept="image/*">

        <button id="analyze-btn" onclick="analyze()">ë¶„ì„í•˜ê¸°</button>

        <p class="loading-text" id="loading">
            AIê°€ ë¶„ì„ ì¤‘<span class="dot-animation"></span>
        </p>

        <div id="result">
            <div class="animal-card">
                <div class="result-emoji" id="result-emoji"></div>
                <div class="result-type" id="result-type"></div>
                <div class="result-percent" id="result-percent"></div>
                <div class="result-bar-wrap">
                    <div class="result-bar" id="result-bar"></div>
                </div>
                <div class="result-desc" id="result-desc"></div>
                <div class="result-tags" id="result-tags"></div>
            </div>

            <div class="menu-section">
                <div class="menu-section-title">ğŸ½ï¸ ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë©”ë‰´</div>
                <div class="menu-cards" id="menu-cards"></div>
            </div>

            <button id="retry-btn" onclick="retry()">ë‹¤ì‹œ í…ŒìŠ¤íŠ¸í•˜ê¸°</button>
        </div>
    </div>

    <script>
        const MODEL_URL = "https://teachablemachine.withgoogle.com/models/jv_X2MJHQ/";
        let model;

        const animalData = {
            "ê°•ì•„ì§€": {
                emoji: "ğŸ¶",
                label: "ê°•ì•„ì§€ìƒ",
                color: "dog",
                desc: "ë‹¹ì‹ ì€ ê°•ì•„ì§€ìƒ! ë°ê³  í™œê¸°ì°¬ ì—ë„ˆì§€ì˜ ì†Œìœ ìì…ë‹ˆë‹¤. ì‚¬ëŒë“¤ì—ê²Œ ë¨¼ì € ë‹¤ê°€ê°€ê³ , ì¹œí™”ë ¥ì´ ë„˜ì¹˜ë©°, í•¨ê»˜ ìˆìœ¼ë©´ ê¸°ë¶„ì´ ì¢‹ì•„ì§€ëŠ” ì‚¬ëŒì´ì—ìš”. ì¶©ì„±ì‹¬ì´ ê°•í•˜ê³  ì†”ì§í•œ ì„±ê²©ìœ¼ë¡œ ì£¼ë³€ì— íŒ¬ì´ ë§ìŠµë‹ˆë‹¤.",
                tags: ["#ì¹œí™”ë ¥MAX", "#ë°ì€ì—ë„ˆì§€", "#ì¶©ì„±íŒŒ", "#ì‚¬êµì ", "#ì†”ì§ë‹´ë°±"]
            },
            "ê³ ì–‘ì´": {
                emoji: "ğŸ±",
                label: "ê³ ì–‘ì´ìƒ",
                color: "cat",
                desc: "ë‹¹ì‹ ì€ ê³ ì–‘ì´ìƒ! ë„ë„í•˜ë©´ì„œë„ ë§¤ë ¥ì ì¸ ë¶„ìœ„ê¸°ì˜ ì†Œìœ ìì…ë‹ˆë‹¤. ë…ë¦½ì ì´ê³  ìê¸°ë§Œì˜ ì„¸ê³„ê°€ í™•ê³ í•˜ë©°, ì€ê·¼í•œ ì¹´ë¦¬ìŠ¤ë§ˆë¡œ ì‚¬ëŒë“¤ì„ ëŒì–´ë‹¹ê¹ë‹ˆë‹¤. ê°€ê¹Œìš´ ì‚¬ëŒì—ê²Œë§Œ ë³´ì—¬ì£¼ëŠ” ë°˜ì „ ë§¤ë ¥ì´ í¬ì¸íŠ¸!",
                tags: ["#ë„ë„í•œë§¤ë ¥", "#ë…ë¦½ì ", "#ì€ê·¼ì¹´ë¦¬ìŠ¤ë§ˆ", "#ë°˜ì „ë§¤ë ¥", "#ë¯¸ìŠ¤í„°ë¦¬"]
            }
        };

        const classNameMap = {
            "dog": "ê°•ì•„ì§€", "Dog": "ê°•ì•„ì§€", "ê°•ì•„ì§€": "ê°•ì•„ì§€",
            "cat": "ê³ ì–‘ì´", "Cat": "ê³ ì–‘ì´", "ê³ ì–‘ì´": "ê³ ì–‘ì´"
        };

        // Menu data mapped by animal type
        const menusByAnimal = {
            "ê°•ì•„ì§€": [
                { name: 'Grilled Pork Belly', nameKo: 'ì‚¼ê²¹ì‚´', emoji: 'ğŸ¥“', category: 'Korean', image: 'https://via.placeholder.com/150' },
                { name: 'Tteokbokki', nameKo: 'ë–¡ë³¶ì´', emoji: 'ğŸŒ¶ï¸', category: 'Korean', image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/Tteokbokki.JPG/1280px-Tteokbokki.JPG' },
                { name: 'Fried Chicken', nameKo: 'ì¹˜í‚¨', emoji: 'ğŸ—', category: 'Korean', image: 'https://upload.wikimedia.org/wikipedia/commons/a/a2/Fried-Chicken-Set.jpg' },
                { name: 'Jjamppong', nameKo: 'ì§¬ë½•', emoji: 'ğŸ¥¡', category: 'Chinese', image: 'https://upload.wikimedia.org/wikipedia/commons/a/a0/Jjamppong_%28Korean_Chines_seafood_noodle_soup%29.jpg' },
                { name: 'Malatang', nameKo: 'ë§ˆë¼íƒ•', emoji: 'ğŸŒ¶ï¸', category: 'Chinese', image: 'https://via.placeholder.com/150' },
                { name: 'Pizza', nameKo: 'í”¼ì', emoji: 'ğŸ•', category: 'Western', image: 'http://www.public-domain-image.com/public-domain-images-pictures-free-stock-photos/food-and-drink-public-domain-images-pictures/pizza-public-domain-images-pictures/pizza.jpg' },
                { name: 'Hamburger', nameKo: 'í–„ë²„ê±°', emoji: 'ğŸ”', category: 'Western', image: 'https://images.unsplash.com/photo-1571091718767-897e792f20d7?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
                { name: 'Bulgogi', nameKo: 'ë¶ˆê³ ê¸°', emoji: 'ğŸ¥©', category: 'Korean', image: 'https://upload.wikimedia.org/wikipedia/commons/f/f6/Korean.food-Bulgogi-01.jpg' },
                { name: 'Ramen', nameKo: 'ë¼ë©˜', emoji: 'ğŸœ', category: 'Japanese', image: 'https://png.pngitem.com/png/full/2-20090_ramen-png-ramen.png' },
                { name: 'Kimchi Stew', nameKo: 'ê¹€ì¹˜ì°Œê°œ', emoji: 'ğŸ²', category: 'Korean', image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/60/Korean_stew-Kimchi_jjigae-01.jpg/1280px-Korean_stew-Kimchi_jjigae-01.jpg' },
                { name: 'Spicy Pork Stir-fry', nameKo: 'ì œìœ¡ë³¶ìŒ', emoji: 'ğŸ–', category: 'Korean', image: 'https://via.placeholder.com/150' },
                { name: 'Sweet & Sour Pork', nameKo: 'íƒ•ìˆ˜ìœ¡', emoji: 'ğŸ–', category: 'Chinese', image: 'https://www.photo-ac.com/assets/img/ai/28430023_2160x1442.jpeg' },
            ],
            "ê³ ì–‘ì´": [
                { name: 'Pasta', nameKo: 'íŒŒìŠ¤íƒ€', emoji: 'ğŸ', category: 'Western', image: 'https://upload.wikimedia.org/wikipedia/commons/a/a8/Pasta_%281%29.jpg' },
                { name: 'Sushi', nameKo: 'ìŠ¤ì‹œ', emoji: 'ğŸ£', category: 'Japanese', image: 'https://images.unsplash.com/photo-1579871127000-211411526272?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' },
                { name: 'Steak', nameKo: 'ìŠ¤í…Œì´í¬', emoji: 'ğŸ¥©', category: 'Western', image: 'https://via.placeholder.com/150' },
                { name: 'Tonkatsu', nameKo: 'ëˆì¹´ì¸ ', emoji: 'ğŸ¥©', category: 'Japanese', image: 'https://upload.wikimedia.org/wikipedia/commons/a/a8/Original_Tonkatsu.jpg' },
                { name: 'Bibimbap', nameKo: 'ë¹„ë¹”ë°¥', emoji: 'ğŸš', category: 'Korean', image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/20/Bibimbap_%288111593238%29.jpg/1280px-Bibimbap_%288111593238%29.jpg' },
                { name: 'Pad Thai', nameKo: 'íŒŸíƒ€ì´', emoji: 'ğŸ¥˜', category: 'Asian', image: 'https://via.placeholder.com/150' },
                { name: 'Pho', nameKo: 'ìŒ€êµ­ìˆ˜', emoji: 'ğŸœ', category: 'Asian', image: 'https://via.placeholder.com/150' },
                { name: 'Japchae', nameKo: 'ì¡ì±„', emoji: 'ğŸœ', category: 'Korean', image: 'https://upload.wikimedia.org/wikipedia/commons/e/e7/Korean_cuisine_japchae.jpg' },
                { name: 'Soybean Paste Stew', nameKo: 'ëœì¥ì°Œê°œ', emoji: 'ğŸ¥˜', category: 'Korean', image: 'https://mykoreankitchen.com/wp-content/uploads/2020/02/200226_Doenjang-Jjigae_10-500x500.jpg' },
                { name: 'Udon', nameKo: 'ìš°ë™', emoji: 'ğŸ²', category: 'Japanese', image: 'https://via.placeholder.com/150' },
                { name: 'Jajangmyeon', nameKo: 'ìì¥ë©´', emoji: 'ğŸ', category: 'Chinese', image: 'https://images.unsplash.com/photo-1622543925800-aa658667672d?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2000&q=80' },
                { name: 'Curry', nameKo: 'ì¹´ë ˆ', emoji: 'ğŸ›', category: 'Asian', image: 'https://upload.wikimedia.org/wikipedia/commons/e/e0/Chickpea_Curry_%2857189%29.jpg' },
            ]
        };

        function getRandomMenus(animal, count) {
            const pool = [...menusByAnimal[animal]];
            const picked = [];
            for (let i = 0; i < count && pool.length > 0; i++) {
                const idx = Math.floor(Math.random() * pool.length);
                picked.push(pool.splice(idx, 1)[0]);
            }
            return picked;
        }

        // File input handler
        const fileInput = document.getElementById("file-input");
        const previewImg = document.getElementById("preview-img");
        const uploadArea = document.getElementById("upload-area");
        const analyzeBtn = document.getElementById("analyze-btn");

        fileInput.addEventListener("change", function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(ev) {
                previewImg.src = ev.target.result;
                previewImg.style.display = "block";
                uploadArea.classList.add("has-image");
                uploadArea.querySelector(".upload-icon").style.display = "none";
                uploadArea.querySelector(".upload-text").style.display = "none";
                uploadArea.querySelector(".upload-hint").style.display = "none";
                analyzeBtn.style.display = "inline-block";
            };
            reader.readAsDataURL(file);
        });

        // Drag & drop
        uploadArea.addEventListener("dragover", function(e) {
            e.preventDefault();
            uploadArea.style.borderColor = "#667eea";
            uploadArea.style.background = "#f0f0ff";
        });

        uploadArea.addEventListener("dragleave", function(e) {
            e.preventDefault();
            uploadArea.style.borderColor = "";
            uploadArea.style.background = "";
        });

        uploadArea.addEventListener("drop", function(e) {
            e.preventDefault();
            uploadArea.style.borderColor = "";
            uploadArea.style.background = "";
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith("image/")) {
                fileInput.files = e.dataTransfer.files;
                fileInput.dispatchEvent(new Event("change"));
            }
        });

        async function analyze() {
            analyzeBtn.disabled = true;
            analyzeBtn.textContent = "ë¶„ì„ ì¤‘...";
            document.getElementById("loading").style.display = "block";

            try {
                if (!model) {
                    const modelURL = MODEL_URL + "model.json";
                    const metadataURL = MODEL_URL + "metadata.json";
                    model = await tmImage.load(modelURL, metadataURL);
                }

                const prediction = await model.predict(previewImg);

                let best = prediction[0];
                for (let i = 1; i < prediction.length; i++) {
                    if (prediction[i].probability > best.probability) best = prediction[i];
                }

                const className = classNameMap[best.className] || best.className;
                const data = animalData[className] || animalData["ê°•ì•„ì§€"];
                const percent = Math.round(best.probability * 100);

                // Hide upload UI
                uploadArea.style.display = "none";
                analyzeBtn.style.display = "none";
                document.getElementById("loading").style.display = "none";

                // Show animal result
                document.getElementById("result-emoji").textContent = data.emoji;

                const typeEl = document.getElementById("result-type");
                typeEl.textContent = data.label;
                typeEl.className = "result-type " + data.color;

                const percentEl = document.getElementById("result-percent");
                percentEl.textContent = percent + "%";
                percentEl.className = "result-percent " + data.color;

                const bar = document.getElementById("result-bar");
                bar.className = "result-bar " + data.color;
                bar.style.width = "0%";

                document.getElementById("result-desc").textContent = data.desc;

                const tagsEl = document.getElementById("result-tags");
                tagsEl.innerHTML = "";
                data.tags.forEach(tag => {
                    const span = document.createElement("span");
                    span.className = "tag " + data.color;
                    span.textContent = tag;
                    tagsEl.appendChild(span);
                });

                // Show recommended menus
                const menus = getRandomMenus(className, 3);
                const menuCardsEl = document.getElementById("menu-cards");
                menuCardsEl.innerHTML = "";
                menus.forEach(menu => {
                    const card = document.createElement("div");
                    card.className = "menu-card";
                    card.innerHTML = `
                        <img class="menu-card-img" src="${menu.image}" alt="${menu.nameKo}" onerror="this.src='https://via.placeholder.com/150'">
                        <div class="menu-card-info">
                            <div class="menu-card-name">${menu.emoji} ${menu.nameKo}</div>
                            <div class="menu-card-meta">${menu.name} Â· ${menu.category}</div>
                        </div>
                    `;
                    menuCardsEl.appendChild(card);
                });

                document.getElementById("result").style.display = "block";
                setTimeout(() => { bar.style.width = percent + "%"; }, 100);

            } catch (e) {
                alert("ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = "ë¶„ì„í•˜ê¸°";
                document.getElementById("loading").style.display = "none";
            }
        }

        function retry() {
            document.getElementById("result").style.display = "none";
            uploadArea.style.display = "";
            uploadArea.classList.remove("has-image");
            uploadArea.querySelector(".upload-icon").style.display = "";
            uploadArea.querySelector(".upload-text").style.display = "";
            uploadArea.querySelector(".upload-hint").style.display = "";
            previewImg.style.display = "none";
            previewImg.src = "";
            fileInput.value = "";
            analyzeBtn.style.display = "none";
            analyzeBtn.disabled = false;
            analyzeBtn.textContent = "ë¶„ì„í•˜ê¸°";
        }
    </script>
</body>
</html>
